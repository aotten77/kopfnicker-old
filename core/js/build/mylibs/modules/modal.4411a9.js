define(["jquery","actions.ajax","md5"],function(a,b,c){"use strict";var d=a.extend({},b,{onInitExec:function(){b.onInitExec.call(this),this.subObj_injection="html"},options:{},_exec:function(){this.$modal=a("#"+this._getID()),window.requestAnimationFrame(this.$modal.doesExist()?this._open.bind(this):this._createModal.bind(this))},_createModal:function(){this.$modal=a('<div id="'+this._getID()+'" class="mask"><div class="modal-bar"><a class="modal-close">Close</a></div><div class="modal"><div class="modal-dialog"></div></div></div>'),a("body").append(this.$modal),window.requestAnimationFrame(this._open.bind(this)),window.requestAnimationFrame(this._execAjax.bind(this))},_getID:function(){return this.$elem.attr("href").match(/^#(.*)/g)?this.$elem.attr("href").replace("#",""):c(this.$elem.attr("href"))},_execAjax:function(){this.subObj_$destination=this.$modal.find(".modal-dialog"),b._exec.call(this),this.$modal.addClass("is-loading")},_open:function(){this.div=jmHF.getScrollPos()/a(document).height()*25-50,this.$modal.find(".modal-dialog").css({transform:"translateY("+this.div+"%) rotateX(15deg)"}),this.$modal.css({height:a(document).height(),"padding-top":jmHF.getScrollPos()}),setTimeout(function(){this.$modal.find(".modal-dialog").css({transform:"translateY(0%) rotateX(0deg)"}),this.$modal.addClass("open")}.bind(this),100),this.$modal.find(".modal-dialog").on("click",function(a){a.stopPropagation()}),this.$modal.find(".modal-dialog").on("click",".modal-close",this._close.bind(this)),this.$modal.find(".rt-modal-btn").on("click",function(b){b.preventDefault(),a(".modal-legal").remove(),a(".modal-dialog").append('<div class="modal-legal"></div>'),a(".modal-legal").load(b.currentTarget.href),a("html, body").animate({scrollTop:a(document).height()},1e3)}),this.$modal.on("click",this._close.bind(this))},_close:function(b){var c=this;b.preventDefault(),c.$modal.css("padding-top",0),c.$modal.find(".modal-dialog").css("transform","translateY("+this.div+"%) rotateX(15deg)"),c.$modal.addClass("close"),setTimeout(function(){c.$modal.removeClass("close open"),a(".modal-legal").remove()},800)},ajaxCompleteCallback:function(){this.$modal.removeClass("is-loading")}});return a.plugin("modules.modal",d),d});